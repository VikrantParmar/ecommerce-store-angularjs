<!-- Product Details Section -->
<section class="py-5">
  <div class="container">
    <!-- Loader -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="custom-spinner mx-auto"></div>
    </div>

    <!-- Not Found -->
    <div *ngIf="!loading && !product" class="text-center py-5">
      <img src="images/product-not-found.png" height="200" class="mb-3" alt="Product Not Found" />
      <div>
        <button routerLink="/" class="btn btn-dark">Go to Home</button>
      </div>
    </div>

    <!-- Image Section Start  -->
    <div class="row g-5 align-items-start" *ngIf="!loading && product">
      <div class="col-lg-6 col-md-8 col-sm-10 col-12 mx-auto">
        <!-- Main Image with Zoom Effect -->
        <div class="product-image-wrapper text-center" (mouseenter)="onMouseEnter($event)"
          (mousemove)="onMouseMove($event)" (mouseleave)="onMouseLeave()">
          <img [src]="selectedImageUrl || getImageUrl(product.img)" class="img-fluid product-main-image"
            [alt]="product.name" />

          <!-- Zoomed Image Overlay -->
          <div class="zoom-overlay" *ngIf="isZoomActive">
            <img [src]="selectedImageUrl || getImageUrl(product.image)" class="zoomed-img"
              [alt]="product.name + ' zoomed image'" />
          </div>
        </div>

        <!-- Thumbnails -->
        <div class="d-flex justify-content-center gap-2 flex-wrap mt-3">
          <img *ngIf="product.image" [src]="getImageUrl(product.image)" class="img-thumbnail product-thumbnail"
            [ngClass]="{
              'border-primary border-3':
                selectedImageUrl === getImageUrl(product.image)
            }" [alt]="product.name + ' thumbnail'" (click)="setMainImage(getImageUrl(product.image))" />

          <img *ngFor="let img of selectedVariant?.images" [src]="getVariantImageUrl(img.image_url)"
            class="img-thumbnail product-thumbnail" [ngClass]="{
              'border-primary border-1':
                selectedImageUrl === getVariantImageUrl(img.image_url)
            }" [alt]="product.name + ' variant'" (click)="setMainImage(getVariantImageUrl(img.image_url))" />
        </div>
      </div>

      <!-- Image Section End   -->

      <!-- Product Info -->
      <div class="col-lg-6">
        <div class="bg-white rounded shadow-sm p-4">
          <h1 class="h4 fw-bold mb-4">{{ product.name }}</h1>

          <div class="mb-4">
            <!-- Variant Price on Top -->
            <!-- <span class="text-dark h5 fw-bold">
              {{ format(selectedVariant?.price || product.price) }}
            </span> -->

            <span class="text-dark h5 fw-bold">
              {{ format(selectedVariant?.price ?? product.price) }}
            </span>

          </div>

          <!-- Quantity Selector -->
          <div class="mb-4 d-flex align-items-center gap-3">
            <label class="form-label text-dark mb-0">Quantity:</label>
            <div class="input-group flex-nowrap qty-group">
              <!-- Decrease button -->
              <button class="btn btn-outline-dark" type="button" (click)="decreaseQty()"
                [disabled]="quantity <= 1 || loading">
                -
              </button>

              <!-- Quantity Display -->
              <input type="text" class="form-control text-center" [value]="quantity" readonly />

              <!-- Increase button -->
              <button class="btn btn-outline-dark" type="button" (click)="increaseQty()"
                [disabled]="loading || quantity >= (selectedVariant?.stock ?? product.stock)">
                +
              </button>

            </div>
          </div>

          <!-- Amazon-Style Attribute Selectors -->
          <div *ngFor="let attr of product.attributes" class="mb-4">
            <label class="form-label fw-semibold text-muted d-block">
              {{ attr.name }}:
              <span *ngIf="selectedAttributes[attr.name]" class="text-dark">
                {{ selectedAttributes[attr.name] }}
              </span>
            </label>

            <div class="d-flex flex-wrap gap-3 mt-2">
              <!-- Color Attribute using variant image directly -->
              <ng-container *ngIf="
                  attr.name.toLowerCase() === 'color';
                  else otherAttributes
                ">
                <div *ngFor="let val of attr.values" class="amazon-color-image-swatch position-relative"
                  [class.selected]="selectedAttributes[attr.name] === val"
                  [class.disabled]="!isValueAvailable(attr.name, val)" (click)="
                    isValueAvailable(attr.name, val) &&
                      onSelectAttribute(attr.name, val)
                  ">
                  <ng-container *ngIf="colorVariantMap[val] as variant">
                    <img [src]="getVariantImageUrl(variant.images[0].image_url)" [alt]="val"
                      class="color-thumbnail-img" />
                  </ng-container>

                  <small *ngIf="getAvailabilityLabel(attr.name, val)" class="text-danger d-block">
                    {{ getAvailabilityLabel(attr.name, val) }}
                  </small>
                </div>
              </ng-container>

              <!-- Other Attributes -->
              <ng-template #otherAttributes>
                <div *ngFor="let val of attr.values" class="amazon-pill position-relative"
                  [class.selected]="selectedAttributes[attr.name] === val"
                  [class.disabled]="!isValueAvailable(attr.name, val)" (click)="
                    isValueAvailable(attr.name, val) &&
                      onSelectAttribute(attr.name, val)
                  ">
                  {{ val }}

                  <small *ngIf="getAvailabilityLabel(attr.name, val)" class="text-danger d-block">
                    {{ getAvailabilityLabel(attr.name, val) }}
                  </small>
                </div>
              </ng-template>
            </div>
          </div>

          <!-- Buttons -->
          <!-- Buttons -->
          <div class="text mb-4">
            <button class="btn btn-dark custom-add-btn px-4"
              [disabled]="(selectedVariant ? selectedVariant.stock : product.stock) === 0"
              (click)="addToCart(product); $event.preventDefault(); $event.stopPropagation()">
              Add to Cart
            </button>
          </div>


          <!-- Stock Message -->
          <div class="mb-3">
            <!-- Out of Stock -->
            <span *ngIf="(selectedVariant?.stock ?? product.stock) === 0"
              class="badge bg-danger px-3 py-2 fs-6 fw-semibold rounded">
              Out of Stock
            </span>

            <!-- Low Stock -->
            <span
              *ngIf="(selectedVariant?.stock ?? product.stock) > 0 && (selectedVariant?.stock ?? product.stock) <= 5"
              class="badge bg-warning text-dark px-3 py-2 fs-6 fw-semibold rounded">
              Only {{ selectedVariant?.stock ?? product.stock }} product left in stock!
            </span>

            <!-- In Stock (Optional - if you want to show message when stock is fine) -->
            <span *ngIf="(selectedVariant?.stock ?? product.stock) > 5"
              class="badge bg-success px-3 py-2 fs-6 fw-semibold rounded">
              In Stock
            </span>
          </div>













          <!-- Description -->
          <p class="text-secondary small">
            Our <strong>{{ product.name }}</strong> is inspired by the classic
            mid-century wingback but with a new geometric shape. Generous
            seating, luxurious details, and bold fabric choices make this a
            standout piece.
            <strong>{{ product.des }}</strong>
          </p>

          <!-- Suggested Pairing -->
          <p class="text-muted small">
            <strong>Suggested Fabric Pairing:</strong> Bright solids or textured
            fabrics for bold contrast.
          </p>

          <!-- Info Icons -->
          <div class="row justify-content-center mt-4">
            <div class="col-12 col-md-8 text-center">
              <img src="images/price gst.webp" alt="Price Icons" class="img-fluid price-icon-img" />
            </div>
          </div>

          <!-- Accordion -->
          <div class="accordion mt-4" id="accordionDetails">
            <!-- Product Details -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
                  aria-expanded="true" aria-controls="collapseOne">
                  Product Details
                </button>
              </h2>
              <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                data-bs-parent="#accordionDetails">
                <div class="accordion-body small">
                  <ul class="list-unstyled mb-0">
                    <li><strong>Product</strong> : {{ product.name }}</li>
                    <li><strong>Size:</strong> 71L X 76D X 84H CM</li>
                    <li>
                      <strong>Seat Dimensions:</strong> 54L x 52D x 33H CM
                    </li>
                    <li>
                      <strong>Material:</strong> Teak Wood, Wadding, Hardwood
                      Frame, Wicker
                    </li>
                    <li><strong>Foam Level:</strong> Firm</li>
                    <li><strong>Style:</strong> Mid Century</li>
                    <li><strong>Custom Fabric:</strong> Available</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Shipping & Returns -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  Shipping & Returns
                </button>
              </h2>
              <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                data-bs-parent="#accordionDetails">
                <div class="accordion-body small">
                  Free shipping above ₹2,000. Estimated delivery in 3–5 business
                  days. 7-day return policy.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Related Products Section -->
<div class="untree_co-section mt-5 mb-5" *ngIf="product?.related?.length > 0">
  <div class="container">
    <h4 class="mb-4 text-center">Related Products</h4>

    <div class="row justify-content-center">
      <div class="col-12 col-xl-10 col-xxl-9">
        <app-product-grid [products]="product.related.slice(0, 5)" [loading]="false"
          [imageUrlFn]="getImageUrl.bind(this)" (addToCart)="addToCart($event)">
        </app-product-grid>
      </div>
    </div>
  </div>
</div>

<section class="product-help-section py-5 border-top border-bottom bg-light mb-5">
  <div class="container text-center">
    <h3 class="fw-bold mb-4">Any questions on this product?</h3>

    <div class="d-flex flex-column flex-md-row justify-content-center align-items-center gap-3 mb-3">
      <button class="btn help-btn btn-dark w-100 w-md-auto">
        <i class="bi bi-telephone-fill fs-6 fs-md-5 me-2"></i> Call Us
      </button>
      <button class="btn help-btn btn-dark w-100 w-md-auto">
        <i class="bi bi-whatsapp fs-6 fs-md-5 me-2"></i> WhatsApp Us
      </button>
      <button class="btn help-btn btn-dark w-100 w-md-auto">
        <i class="bi bi-envelope-fill fs-6 fs-md-5 me-2"></i> Email Us
      </button>
    </div>

    <p class="fst-italic fw-semibold small text-uppercase">
      We’d love to chat and help you make the perfect selection
    </p>

    <a routerLink="/shop" class="btn back-btn mt-4 btn-dark">
      <i class="bi bi-arrow-left fs-6 me-2"></i> Back to Furniture
    </a>
  </div>
</section>
