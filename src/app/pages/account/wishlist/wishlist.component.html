<h4 class="mb-4">My Wishlist</h4>

<!-- Loader -->
<div *ngIf="loading" class="cart-loader text-center my-5">
  <div class="custom-spinner"></div>
</div>

<!-- Wishlist Items -->
<div *ngIf="!loading && wishlist.length > 0" class="row g-3">
  <div class="col-12 col-md-6 col-lg-4" *ngFor="let item of wishlist">

    <!-- Card clickable with routerLink -->
    <div class="card wishlist-card shadow-sm rounded-4 position-relative d-flex flex-column h-100"
      [routerLink]="['/product', item.product.slug]">

      <!-- Product Image -->
      <div class="wishlist-img position-relative text-center p-3 bg-light rounded-top">
        <img [src]="getCartImageUrl(item)" alt="{{ item.product.name }}" class="wishlist-img-item">

        <!-- Out of Stock Badge -->
        <span *ngIf="(item.variant?.stock ?? item.product.stock) === 0" class="badge badge-out-of-stock">
          Out of Stock
        </span>

        <!-- Low Stock Badge -->
        <span *ngIf="(item.variant?.stock ?? item.product.stock) > 0 && (item.variant?.stock ?? item.product.stock) <= 5"
          class="badge badge-low-stock">
          Only {{ item.variant?.stock ?? item.product.stock }} left
        </span>
      </div>

      <!-- Product Details -->
      <div class="card-body d-flex flex-column justify-content-between p-2">
        <div>
          <h6 class="product-name text-truncate">
            {{ item.product.name }}
          </h6>

          <!-- Rating Display -->
          <app-rating-display [product]="item.product"></app-rating-display>

          <p *ngIf="item.variant?.variantAttributes?.length" class="variant-attributes text-truncate">
            <ng-container *ngFor="let attr of item.variant.variantAttributes; let i = index">
              {{ attr.attributeValue?.attribute?.name }}: {{ attr.attributeValue?.value }}
              <span *ngIf="i < item.variant.variantAttributes.length - 1">|</span>
            </ng-container>
          </p>

          <div class="product-price fw-bold">
            {{ format(item.variant?.price ?? item.product.price) }}
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons d-flex justify-content-between align-items-center mt-2">
          <button (click)="moveToCart(item); $event.stopPropagation()" class="btn btn-primary btn-sm"
            [disabled]="(item.variant?.stock ?? item.product.stock) === 0"
            [title]="(item.variant?.stock ?? item.product.stock) === 0 ? 'Out of Stock' : 'Add to Cart'">
            Add to Cart
          </button>

          <button (click)="removeItem(item.product.id, item.variant?.id ?? null); $event.stopPropagation()"
            class="btn btn-outline-danger" title="Remove">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Empty Wishlist -->
<div *ngIf="!loading && wishlist.length === 0" class="alert alert-info mt-5 mb-5 text-center">
  Your wishlist is currently empty.
</div>
