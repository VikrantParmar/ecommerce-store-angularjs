<h4 class="mb-4">My Orders</h4>

<!-- Loader -->
<div *ngIf="loading" class="cart-loader text-center my-5">
  <div class="custom-spinner"></div>
</div>

<!-- Orders List -->
<div *ngIf="!loading && orders.length > 0" class="row g-3">
  <div class="col-12" *ngFor="let order of orders">
    <div class="card shadow-sm rounded-3 h-100">

      <!-- Card Body clickable using routerLink -->
      <a [routerLink]="['/account/my-orders', order.orderNumber]" class="text-decoration-none text-dark">
        <div class="card-body">

          <!-- Order Number + Status -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <p class="text-muted small mb-0">Order #{{ order.orderNumber }}</p>
            <span class="badge text-uppercase rounded {{ getStatusClass(order.status) }}">
              {{ order.status }}
            </span>
          </div>

          <!-- Items -->
          <p class="text-muted small mb-1">Items: {{ order.totalItems }}</p>

          <!-- Placed On + Total Price -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <p class="text-muted small mb-0">Placed on: {{ order.createdAt | date: 'medium' }}</p>
            <div class="fw-bold">{{ format(order.totalPrice) }}</div>
          </div>

          <!-- Refund Status -->
          <div *ngIf="order.status === 'Cancelled'" class="mt-2">
            <span *ngIf="order.payments?.[0]?.refundStatus === 'initiated'" class="badge bg-warning text-dark">
              Refund Initiated
            </span>
            <span *ngIf="order.payments?.[0]?.refundStatus === 'succeeded'" class="badge bg-success">
              Refund Completed
            </span>
          </div>

        </div>
      </a>

      <!-- Card Footer -->
      <div class="card-footer bg-light d-flex align-items-center justify-content-between">
        <div></div>

        <!-- Rating (only for Delivered) -->
        <div class="text-center cursor-pointer" *ngIf="order.status === 'Delivered'"
             (click)="goToRating(order.order_items?.[0]?.product); $event.stopPropagation()">
          Rate your order
        </div>

        <!-- Invoice Button -->
        <button class="order-btn invoice-btn btn btn-sm btn-outline-primary"
                (click)="downloadInvoice(order.id, order.orderNumber); $event.stopPropagation();"
                [disabled]="loadingInvoice[order.id]" *ngIf="order.invoicePdfUrl">
          <i *ngIf="!loadingInvoice[order.id]" class="bi bi-file-earmark-pdf"></i>
          <span *ngIf="loadingInvoice[order.id]" class="spinner-border spinner-border-sm"></span>
          {{ loadingInvoice[order.id] ? 'Downloading' : 'Invoice' }}
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Empty Orders -->
<div *ngIf="!loading && orders.length === 0" class="alert alert-info mt-5 mb-5 text-center">
  No orders found.
</div>
