<div class="timeline-container" *ngIf="!loading && !error; else stateBlock">
  <div *ngFor="let log of stepLogs; let i = index" class="timeline-item">

    <div class="timeline-marker" [ngClass]="{
       'cancelled': log.status.toLowerCase() === 'cancelled',
       'delivered': log.status.toLowerCase() === 'delivered',
       'completed': i < currentStepIndex && log.status.toLowerCase() !== 'delivered' && log.status.toLowerCase() !== 'cancelled',
       'active': i === currentStepIndex && !cancelled && log.status.toLowerCase() !== 'delivered' && log.status.toLowerCase() !== 'cancelled',
       'pending': i > currentStepIndex && !log.createdAt
    }">
      <!-- Delivered / Completed: check icon -->
      <span *ngIf="log.status.toLowerCase() === 'delivered' || (i <= currentStepIndex && log.createdAt && log.status.toLowerCase() !== 'cancelled')">
        <i class="fa-solid fa-check text-white"></i>
      </span>

      <!-- Cancelled: X icon -->
      <span *ngIf="log.status.toLowerCase() === 'cancelled'">
        <i class="fa-solid fa-xmark text-white"></i>
      </span>
    </div>

    <div class="timeline-line" [ngClass]="{ 'completed': i < currentStepIndex }" *ngIf="i < stepLogs.length - 1"></div>

    <div class="timeline-content">
      <h6>{{ log.status }}</h6>
      <small *ngIf="log.createdAt">{{ log.createdAt | date:'EEE, d MMM y, h:mm a' }}</small>
      <p *ngIf="log.location">{{ log.location }}</p>
    </div>

  </div>
</div>

<ng-template #stateBlock>
  <p *ngIf="loading">Loading tracking...</p>
  <p *ngIf="error">{{ error }}</p>
</ng-template>
